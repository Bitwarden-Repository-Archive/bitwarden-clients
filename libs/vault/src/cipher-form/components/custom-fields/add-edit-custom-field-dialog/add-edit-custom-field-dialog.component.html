<form [formGroup]="customFieldForm" [bitSubmit]="submit">
  <bit-dialog *ngIf="variant === 'add'">
    <span bitDialogTitle>
      {{ "addField" | i18n }}
    </span>
    <div bitDialogContent>
      <div class="tw-flex tw-mb-2 tw-justify-center">
        <bit-toggle-group class="tw-flex-grow tw-flex" selected="basic">
          <bit-toggle
            class="tw-flex-grow tw-max-w-lg"
            value="basic"
            (click)="setSelectExistingField(false)"
            >New</bit-toggle
          >
          <bit-toggle
            class="tw-flex-grow tw-max-w-lg"
            value="advanced"
            (click)="setSelectExistingField(true)"
            >Existing</bit-toggle
          >
        </bit-toggle-group>
      </div>

      <bit-form-field *ngIf="selectExistingField">
        <bit-select id="fieldName" formControlName="selectedExistingField">
          <bit-option
            *ngFor="let field of existingFields$ | async"
            [value]="field"
            [label]="field.name"
          >
            {{ field.name }}:{{ field.type }}({{ field.count }})
          </bit-option>
        </bit-select>
      </bit-form-field>

      <bit-form-field [hidden]="selectExistingField">
        <bit-label>{{ "fieldType" | i18n }}</bit-label>
        <bit-select id="fieldType" formControlName="type">
          <bit-option
            *ngFor="let type of fieldTypeOptions"
            [value]="type.value"
            [label]="type.name"
          ></bit-option>
        </bit-select>
        <bit-hint>
          {{ getTypeHint() }}
        </bit-hint>
      </bit-form-field>

      <bit-form-field [hidden]="selectExistingField" disableMargin>
        <bit-label>{{ "fieldLabel" | i18n }}</bit-label>
        <input bitInput id="fieldLabel" formControlName="label" type="text" />
        <bit-hint *ngIf="customFieldForm.value.type === FieldType.Linked">
          {{ "linkedLabelHelpText" | i18n }}
        </bit-hint>
      </bit-form-field>
    </div>
    <div bitDialogFooter class="tw-flex tw-gap-2 tw-w-full">
      <button bitButton buttonType="primary" type="submit" [disabled]="customFieldForm.invalid">
        {{ "add" | i18n }}
      </button>
      <button bitButton bitDialogClose buttonType="secondary" type="button">
        {{ "cancel" | i18n }}
      </button>
    </div>
  </bit-dialog>
  <bit-dialog *ngIf="variant === 'edit'">
    <span bitDialogTitle>
      {{ "editField" | i18n }}
    </span>
    <div bitDialogContent>
      <bit-form-field disableMargin>
        <bit-label>{{ "fieldLabel" | i18n }}</bit-label>
        <input bitInput id="fieldLabel" formControlName="label" type="text" />
        <bit-hint *ngIf="customFieldForm.value.type === FieldType.Linked">
          {{ "linkedLabelHelpText" | i18n }}
        </bit-hint>
      </bit-form-field>
    </div>
    <div bitDialogFooter class="tw-flex tw-gap-2 tw-w-full">
      <button bitButton buttonType="primary" type="submit" [disabled]="customFieldForm.invalid">
        {{ "save" | i18n }}
      </button>
      <button bitButton bitDialogClose buttonType="secondary" type="button">
        {{ "cancel" | i18n }}
      </button>

      <button
        type="button"
        buttonType="danger"
        class="tw-ml-auto"
        bitIconButton="bwi-trash"
        [appA11yTitle]="'deleteCustomField' | i18n: customFieldForm.value.label"
        (click)="removeField()"
      ></button>
    </div>
  </bit-dialog>
</form>
