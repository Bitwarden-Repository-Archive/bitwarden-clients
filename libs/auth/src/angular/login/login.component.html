<!-- 
  # Table of Contents

    This file contains three templates, one for each visual client.
    
    For easy navigation, search for the following phrases:
      Web Template
      Browser Template
      Desktop Template

    Or simply collapse the templates you are not working on in your editor.

  # UI States

    Each client template has two UI states, defined by `LoginUiState` enum:
      State 1: displays the email input field + continue button
      State 2: displays the master password input field + login button
-->

<!--------------------------------->
<!--        Web Template         -->
<!--------------------------------->
<!--
    TODO-rr-bw: Clarify this comment if necessary. Also check if there's a better way to handle this.

    Why not use <form *ngIf="clientType === ClientType.Web"> to display this section?
    Because this file contains 3 separate templates for Web, Browser, and Desktop. For Web,
    we want access to the masterPasswordInput reference in the class file.
    - If we used *ngIf, we would not be able to access the reference initially.
    - Using a hidden form allows us to access the reference, because it ensures that the element
      reference does exist (it's just potentially hidden instead of non-existent).
  -->
<form
  [ngClass]="{ 'tw-hidden': clientType !== ClientType.Web }"
  [bitSubmit]="submit"
  [formGroup]="formGroup"
>
  <ng-container *ngIf="uiState === LoginUiState.EMAIL_ENTRY">
    <!-- Email Address input -->
    <bit-form-field class="!tw-mb-4">
      <bit-label>{{ "emailAddress" | i18n }}</bit-label>
      <input type="email" formControlName="email" bitInput appAutofocus />
    </bit-form-field>

    <!-- Remember Email input -->
    <bit-form-control class="!tw-mb-4">
      <input type="checkbox" formControlName="rememberEmail" bitCheckbox />
      <bit-label>{{ "rememberEmail" | i18n }}</bit-label>
    </bit-form-control>

    <div class="tw-grid tw-gap-3">
      <!-- Continue button -->
      <button type="submit" bitButton block buttonType="primary" (click)="validateEmail()">
        <span>{{ "continue" | i18n }}</span>
      </button>

      <div class="tw-text-center">{{ "or" | i18n }}</div>

      <!-- Link to Login with Passkey page -->
      <a
        bitButton
        block
        linkType="primary"
        routerLink="/login-with-passkey"
        (mousedown)="$event.preventDefault()"
      >
        <span><i class="bwi bwi-passkey"></i>{{ "logInWithPasskey" | i18n }}</span>
      </a>

      <!-- Link to Login with SSO page -->
      <a
        bitButton
        block
        buttonType="secondary"
        routerLink="/sso"
        [queryParams]="{ email: formGroup.value.email }"
        (click)="saveEmailSettings()"
      >
        <i class="bwi bwi-provider"></i>
        {{ "useSingleSignOn" | i18n }}
      </a>
    </div>
  </ng-container>

  <!--
    TODO-rr-bw: Clarify this comment if necessary. Also check if there's a better way to handle this.

    Why not use <ng-container *ngIf="validatedEmail"> to display this section?
    Because we want access to the masterPasswordInput reference in the class file.
    - Using a hidden div allows us to access the reference without rendering the div initially.
    - Using *ngIf would not allow us to access the reference without rendering the ng-container initially.
  -->
  <div [ngClass]="{ 'tw-hidden': uiState !== LoginUiState.MASTER_PASSWORD_ENTRY }">
    <!-- Master Password input -->
    <bit-form-field class="!tw-mb-1">
      <bit-label>{{ "masterPass" | i18n }}</bit-label>
      <input type="password" formControlName="masterPassword" bitInput #masterPasswordInput />
      <button type="button" bitIconButton bitSuffix bitPasswordInputToggle></button>
    </bit-form-field>

    <!-- Link to Password Hint page -->
    <a
      class="tw-inline-block tw-mb-4 tw-font-semibold"
      routerLink="/hint"
      (mousedown)="goToHint()"
      (click)="saveEmailSettings()"
    >
      {{ "getMasterPasswordHint" | i18n }}
    </a>

    <!-- TODO-rr-bw: will we still be handling captcha? -->
    <!-- Captcha iframe -->
    <div [hidden]="!showCaptcha()">
      <iframe id="hcaptcha_iframe" height="80" sandbox="allow-scripts allow-same-origin"></iframe>
    </div>

    <div class="tw-grid tw-gap-3">
      <!-- Button to Login with Master Password -->
      <button type="submit" bitButton bitFormButton block buttonType="primary">
        <span>{{ "loginWithMasterPassword" | i18n }}</span>
      </button>

      <!-- Button to Login with Device -->
      <ng-container *ngIf="showLoginWithDevice && showPasswordless">
        <div class="tw-text-center">{{ "or" | i18n }}</div>

        <button
          type="button"
          bitButton
          block
          buttonType="secondary"
          (click)="startAuthRequestLogin()"
        >
          <span><i class="bwi bwi-mobile"></i>{{ "loginWithDevice" | i18n }}</span>
        </button>
      </ng-container>
    </div>
  </div>
</form>

<!--------------------------------->
<!--      Browser Template       -->
<!--------------------------------->
<form *ngIf="clientType === ClientType.Browser" [bitSubmit]="submit" [formGroup]="formGroup">
  <main tabindex="-1"></main>
</form>

<!--------------------------------->
<!--      Desktop Template       -->
<!--------------------------------->
<form *ngIf="clientType === ClientType.Desktop" [bitSubmit]="submit" [formGroup]="formGroup">
  <!---------------------------------
    Desktop UI State 1: Email Entry
  ---------------------------------->
  <ng-container *ngIf="!validatedEmail">
    <!-- Email Address input -->
    <bit-form-field>
      <bit-label>{{ "emailAddress" | i18n }}</bit-label>
      <input
        type="email"
        formControlName="email"
        bitInput
        appAutofocus
        (keyup.enter)="continue()"
      />
    </bit-form-field>

    <!-- Remember Email input -->
    <bit-form-control>
      <input type="checkbox" formControlName="rememberEmail" bitCheckbox />
      <bit-label>{{ "rememberEmail" | i18n }}</bit-label>
    </bit-form-control>

    <div class="tw-grid tw-gap-3">
      <!-- Continue button -->
      <button type="submit" bitButton buttonType="primary" (click)="continue()">
        <span> {{ "continue" | i18n }} </span>
      </button>

      <div class="tw-text-center">{{ "or" | i18n }}</div>

      <!-- Link to Login with Passkey page -->
      <button type="button" bitButton block buttonType="secondary" routerLink="/login-with-passkey">
        <span><i class="bwi bwi-passkey"></i> {{ "logInWithPasskey" | i18n }}</span>
      </button>

      <!-- Link to SSO page -->
      <button type="button" bitButton block buttonType="secondary" routerLink="/sso">
        <span><i class="bwi bwi-provider"></i> {{ "useSingleSignOn" | i18n }}</span>
      </button>
    </div>

    <!--
      TODO-rr-bw: in the secondary content ("New to Bitwarden? Create account"), which is
      now being added via app-routing.module.ts, consider if you need to use `registerRoute$ | async
      as in the current desktop login component.
    -->
  </ng-container>

  <!-------------------------------------------
    Desktop UI State 2: Master Password Entry
  -------------------------------------------->

  <ng-container *ngIf="validatedEmail">
    <div class="tw-grid tw-gap-4">
      <div>
        <!-- Master Password input -->
        <bit-form-field class="!tw-mb-1">
          <bit-label>{{ "masterPassword" | i18n }}</bit-label>
          <input type="password" formControlName="masterPassword" bitInput />
          <button type="button" bitIconButton bitSuffix bitPasswordInputToggle></button>
        </bit-form-field>

        <!-- Link to Password Hint page -->
        <a
          class="tw-font-semibold"
          routerLink="/hint"
          (mousedown)="goToHint()"
          (click)="saveEmailSettings()"
        >
          {{ "getMasterPasswordHint" | i18n }}
        </a>
      </div>

      <!-- Button to Login with Master Password -->
      <button type="submit" bitButton bitFormButton block buttonType="primary">
        <span> {{ "loginWithMasterPassword" | i18n }} </span>
      </button>

      <ng-container *ngIf="showLoginWithDevice && showPasswordless">
        <div class="tw-text-center">{{ "or" | i18n }}</div>

        <button
          type="button"
          bitButton
          block
          buttonType="secondary"
          (click)="startAuthRequestLogin()"
        >
          <span><i class="bwi bwi-mobile"></i> {{ "loginWithDevice" | i18n }}</span>
        </button>
      </ng-container>
    </div>
  </ng-container>
</form>
